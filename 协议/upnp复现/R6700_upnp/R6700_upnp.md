# R6700_upnp


upnp协议相关内容请查看固件协议upnp，本文主要记录和加深漏洞原理。


binwalk解压后
![](vx_images/152235022209254.png)

![](vx_images/519444025593536.png)
upnp处理代码在usr/sbin/upnpd中 

---

# ida定位漏洞点 


通过字符串MX Empty , not integer or negative!
定位漏洞点

![](vx_images/275429053355840.png)
整体逻辑是处理MX字符串的时候发生栈溢出。



----


# 固件模拟
通过file命令可知道指令架构为32位ARM 小端序，固件的系统级模拟需要内核镜像文件、文件系统和启动文件，在此网站可进行下载。
```
wget https://people.debian.org/~aurel32/qemu/armhf/debian_wheezy_armhf_standard.qcow2
wget https://people.debian.org/~aurel32/qemu/armhf/vmlinuz-3.2.0-4-vexpress
wget https://people.debian.org/~aurel32/qemu/armhf/initrd.img-3.2.0-4-vexpress

```
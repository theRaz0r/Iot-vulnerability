# dlink645_info_leak

# 信息泄露

![](vx_images/469722389534437.png)

/getcfg.php 分析

提交到了getcfg.php 。
post提交了SERVICES=UPNPAV,ITUNES


# 删除cookies  ，测试未授权
发现可以获取信息，存在未授权




在系统中打开getcfg.php分析（./htdocs/web/getcfg.php）

HTTP/1.1 200 OK
Content-Type: text/xml

<?echo "<?";?>xml version="1.0" encoding="utf-8"<?echo "?>";?>
<postxml>
<? include "/htdocs/phplib/trace.php";

if ($_POST["CACHE"] == "true")
{
	echo dump(1, "/runtime/session/".$SESSION_UID."/postxml");
}
else
{
	if($AUTHORIZED_GROUP < 0)
	{
		/* not a power user, return error message */
		echo "\t<result>FAILED</result>\n";
		echo "\t<message>Not authorized</message>\n";
	}
	else
	{
		/* cut_count() will return 0 when no or only one token. */
		$SERVICE_COUNT = cut_count($_POST["SERVICES"], ",");    //service count //服务数量，并用，分割
		TRACE_debug("GETCFG: got ".$SERVICE_COUNT." service(s): ".$_POST["SERVICES"]);
		$SERVICE_INDEX = 0;
		while ($SERVICE_INDEX < $SERVICE_COUNT)     //以此执行服务
		{
			$GETCFG_SVC = cut($_POST["SERVICES"], $SERVICE_INDEX, ",");
			TRACE_debug("GETCFG: serivce[".$SERVICE_INDEX."] = ".$GETCFG_SVC);
			if ($GETCFG_SVC!="")
			{
				$file = "/htdocs/webinc/getcfg/".$GETCFG_SVC.".xml.php";
				/* GETCFG_SVC will be passed to the child process. */
				if (isfile($file)=="1") dophp("load", $file);
			}
			$SERVICE_INDEX++;
		}
	}
}
?></postxml>

按照他的拼接方式，去看一下/htdocs/webinc/getcfg/".$GETCFG_SVC.".xml.php
/htdocs/webinc/getcfg/UPNPAV.xml.php
/htdocs/webinc/getcfg/ITUNES.xml.php


然后执行dophp("load", "/htdocs/webinc/getcfg/UPNPAV.xml.php");来加载php配置。

所以该功能并未调用到后台二进制程序。
getcfg.php的主要功能是根据servers的输入，调用dophp("load", $file);来进行php初始化配置，然后会通过xml的形式将数据传送回来。


看看可以读取哪些数据

![](vx_images/215383192544771.png)

存在很多敏感数据，例如，我们读取DEVICE.ACCOUNT
![](vx_images/582146300518158.png)
